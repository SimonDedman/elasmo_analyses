<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EEA Data Panel - Remaining Papers to Download</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.dataTables.min.css">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 100%; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h1 { color: #2c3e50; margin-bottom: 10px; }
        .subtitle { color: #7f8c8d; margin-bottom: 20px; }
        .stats { display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; }
        .stat-box { background: #ecf0f1; padding: 15px 25px; border-radius: 6px; text-align: center; }
        .stat-number { font-size: 28px; font-weight: bold; color: #2c3e50; }
        .stat-label { font-size: 12px; color: #7f8c8d; text-transform: uppercase; }
        table.dataTable { font-size: 13px; }
        table.dataTable thead th { background-color: #34495e; color: white; }
        table.dataTable tbody tr:hover { background-color: #ebf5fb !important; }
        table.dataTable tfoot th { padding: 8px; }
        table.dataTable tfoot select, table.dataTable tfoot input { width: 100%; padding: 4px; font-size: 12px; }
        .oa-gold { background: #f1c40f; color: #000; padding: 2px 8px; border-radius: 3px; font-size: 11px; font-weight: bold; }
        .oa-green { background: #27ae60; color: #fff; padding: 2px 8px; border-radius: 3px; font-size: 11px; }
        .oa-hybrid { background: #3498db; color: #fff; padding: 2px 8px; border-radius: 3px; font-size: 11px; }
        .oa-bronze { background: #cd6155; color: #fff; padding: 2px 8px; border-radius: 3px; font-size: 11px; }
        .oa-closed { background: #7f8c8d; color: #fff; padding: 2px 8px; border-radius: 3px; font-size: 11px; }
        .oa-unknown { background: #bdc3c7; color: #000; padding: 2px 8px; border-radius: 3px; font-size: 11px; }
        .priority-1 { font-weight: bold; color: #c0392b; }
        .priority-2 { color: #e67e22; }
        .priority-3 { color: #f39c12; }
        .priority-4 { color: #95a5a6; }
        .status-unavailable { color: #e74c3c; }
        .status-failed { color: #c0392b; font-weight: bold; }
        a.doi-link { color: #2980b9; text-decoration: none; }
        a.doi-link:hover { text-decoration: underline; }
        .instructions { background: #e8f6f3; border-left: 4px solid #1abc9c; padding: 15px; margin-bottom: 20px; }
        .legend { margin-bottom: 20px; padding: 15px; background: #fafafa; border-radius: 4px; border: 1px solid #eee; }
        .legend-title { font-weight: bold; margin-bottom: 10px; color: #2c3e50; }
        .legend-items { display: flex; gap: 20px; flex-wrap: wrap; align-items: center; }
        .updated { color: #95a5a6; font-size: 12px; margin-top: 20px; }
        #loading { text-align: center; padding: 40px; font-size: 18px; color: #7f8c8d; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ¦ˆ EEA Data Panel - Remaining Papers to Download</h1>
        <p class="subtitle">Papers that still need to be acquired for the systematic review</p>
        
        <div class="stats">
            <div class="stat-box"><div class="stat-number">3,862</div><div class="stat-label">Total Remaining</div></div>
            <div class="stat-box"><div class="stat-number">2,597</div><div class="stat-label">Priority 1 (Recent)</div></div>
            <div class="stat-box"><div class="stat-number">1,761</div><div class="stat-label">Open Access Available</div></div>
            <div class="stat-box"><div class="stat-number">1,463</div><div class="stat-label">Closed Access</div></div>
        </div>
        
        <div class="instructions">
            <strong>ðŸ“‹ Instructions:</strong>
            <ul style="margin: 10px 0 0 0; padding-left: 20px;">
                <li>Use the <strong>search box</strong> to find papers by any text</li>
                <li>Use <strong>dropdown filters</strong> in footer for Year, OA Status, Priority, Status</li>
                <li>Click <strong>column headers</strong> to sort</li>
                <li>Click <strong>Export CSV</strong> to download filtered view</li>
            </ul>
        </div>
        
        <div class="legend">
            <div class="legend-title">Open Access Status:</div>
            <div class="legend-items">
                <span><span class="oa-gold">gold</span> Published OA</span>
                <span><span class="oa-green">green</span> Repository</span>
                <span><span class="oa-hybrid">hybrid</span> OA in subscription</span>
                <span><span class="oa-bronze">bronze</span> Free (no license)</span>
                <span><span class="oa-closed">closed</span> Paywalled</span>
                <span><span class="oa-unknown">unknown</span> Unknown</span>
            </div>
            <div style="margin-top: 10px; font-size: 12px; color: #7f8c8d;">
                <strong>Priority:</strong> 1 = Recent+DOI, 2 = 2000s+DOI, 3 = Key journals, 4 = No DOI
            </div>
        </div>
        
        <div id="loading">Loading papers data...</div>
        
        <table id="papersTable" class="display" style="width:100%; display:none;">
            <thead><tr><th>DOI</th><th>Title</th><th>Authors</th><th>Year</th><th>Journal</th><th>OA Status</th><th>Priority</th><th>Status</th><th>Responsible</th></tr></thead>
            <tfoot><tr><th></th><th></th><th></th><th>Year</th><th>Journal</th><th>OA</th><th>Pri</th><th>Status</th><th></th></tr></tfoot>
            <tbody></tbody>
        </table>
        
        <p class="updated">Last updated: 2026-01-13 10:51 | <a href="https://github.com/SimonDedman/elasmo_analyses">GitHub</a></p>
    </div>
    
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
    function escapeHtml(text) {
        if (!text) return '';
        return text.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
    }
    
    $(document).ready(function() {
        $.getJSON('papers_data.json', function(data) {
            var tableData = data.map(function(r) {
                var doiLink = r.doi ? '<a href="https://doi.org/' + encodeURIComponent(r.doi) + '" target="_blank" class="doi-link">' + escapeHtml(r.doi) + '</a>' : '';
                var oaClass = ['gold','green','hybrid','bronze','closed'].includes(r.oa_status) ? 'oa-' + r.oa_status : 'oa-unknown';
                var oaBadge = '<span class="' + oaClass + '">' + r.oa_status + '</span>';
                if (r.oa_url) oaBadge = '<a href="' + r.oa_url + '" target="_blank">' + oaBadge + '</a>';
                var authors = escapeHtml(r.authors);
                var authorsShort = authors.length > 60 ? authors.substring(0,60) + '...' : authors;
                return [
                    doiLink,
                    escapeHtml(r.title),
                    '<span title="' + authors + '">' + authorsShort + '</span>',
                    r.year,
                    escapeHtml(r.journal),
                    oaBadge,
                    '<span class="priority-' + r.priority + '">' + r.priority + '</span>',
                    '<span class="' + (r.status === 'unavailable' ? 'status-unavailable' : r.status === 'failed' ? 'status-failed' : '') + '">' + r.status + '</span>',
                    ''
                ];
            });
            
            $('#loading').hide();
            $('#papersTable').show();
            
            var table = $('#papersTable').DataTable({
                data: tableData,
                pageLength: 50,
                lengthMenu: [[25, 50, 100, 250, -1], [25, 50, 100, 250, "All"]],
                order: [[6, 'asc'], [3, 'desc']],
                dom: 'Blfrtip',
                buttons: [{ extend: 'csv', text: 'ðŸ“¥ Export CSV', filename: 'remaining_papers_' + new Date().toISOString().slice(0,10) }],
                initComplete: function() {
                    this.api().columns([3, 5, 6, 7]).every(function() {
                        var column = this;
                        var select = $('<select><option value="">All</option></select>')
                            .appendTo($(column.footer()).empty())
                            .on('change', function() {
                                var val = $.fn.dataTable.util.escapeRegex($(this).val());
                                column.search(val ? '^' + val + '$' : '', true, false).draw();
                            });
                        column.data().unique().sort().each(function(d) {
                            var text = $('<div>').html(d).text().trim();
                            if (text) select.append('<option value="' + text + '">' + text + '</option>');
                        });
                    });
                    var jCol = this.api().column(4);
                    $('<input type="text" placeholder="Filter...">')
                        .appendTo($(jCol.footer()).empty())
                        .on('keyup change', function() { jCol.search(this.value).draw(); });
                }
            });
        }).fail(function() {
            $('#loading').html('Error loading data. Please refresh the page.');
        });
    });
    </script>
</body>
</html>